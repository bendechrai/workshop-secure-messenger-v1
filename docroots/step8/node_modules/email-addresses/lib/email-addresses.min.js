(function(G){function n(d){function n(a,b){return{name:a,tokens:b||"",semantic:b||"",children:[]}}function c(a,b){if(null===b)return null;a=n(a);a.tokens=b.tokens;a.semantic=b.semantic;a.children.push(b);return a}function q(a,b){null!==b&&(a.tokens+=b.tokens,a.semantic+=b.semantic);a.children.push(b);return a}function r(a){if(!(p<B))return null;var b=y[p];return a(b)?(p+=1,n("token",b)):null}function f(a){return function(){return c("literal",r(function(b){return b===a}))}}function e(){var a=arguments;
return function(){var b;var c=p;var d=n("and");for(b=0;b<a.length;b+=1){var e=a[b]();if(null===e)return p=c,null;q(d,e)}return d}}function h(){var a=arguments;return function(){var b;var c=p;for(b=0;b<a.length;b+=1){var d=a[b]();if(null!==d)return d;p=c}return null}}function g(a){return function(){var b=p;var c=a();if(null!==c)return c;p=b;return n("opt")}}function k(a){return function(){var b=a();null!==b&&(b.semantic="");return b}}function C(a){return function(){var b=a();null!==b&&0<b.semantic.length&&
(b.semantic=" ");return b}}function l(a,b){return function(){var c,d;var e=p;var f=n("star");var g=0;for(d=void 0===b?0:b;null!==(c=a());)g+=1,q(f,c);if(g>=d)return f;p=e;return null}}function O(){return c("cr",f("\r")())}function P(){return c("crlf",e(O,Q)())}function R(){return c("dquote",f('"')())}function G(){return c("htab",f("\t")())}function Q(){return c("lf",f("\n")())}function ca(){return c("sp",f(" ")())}function da(){return c("vchar",r(function(a){var b=a.charCodeAt(0),b=33<=b&&126>=b;
d.rfc6532&&(b=b||128<=a.charCodeAt(0));return b}))}function D(){return c("wsp",h(ca,G)())}function H(){var a=c("quoted-pair",h(e(f("\\"),h(da,D)),ea)());if(null===a)return null;a.semantic=a.semantic[1];return a}function t(){return c("fws",h(fa,e(g(e(l(D),k(P))),l(D,1)))())}function ga(){return c("ctext",h(function(){return r(function(a){var b=a.charCodeAt(0),b=33<=b&&39>=b||42<=b&&91>=b||93<=b&&126>=b;d.rfc6532&&(b=b||128<=a.charCodeAt(0));return b})},ha)())}function ia(){return c("ccontent",h(ga,
H,S)())}function S(){return c("comment",e(f("("),l(e(g(t),ia)),g(t),f(")"))())}function m(){return c("cfws",h(e(l(e(g(t),S),1),g(t)),t)())}function I(){return c("atext",r(function(a){var b="a"<=a&&"z">=a||"A"<=a&&"Z">=a||"0"<=a&&"9">=a||0<="!#$%&'*+-/=?^_`{|}~".split("").indexOf(a);d.rfc6532&&(b=b||128<=a.charCodeAt(0));return b}))}function J(){return c("atom",e(C(g(m)),l(I,1),C(g(m)))())}function ja(){var a=c("dot-atom-text",l(I,1)());if(null===a)return a;var b=l(e(f("."),l(I,1)))();null!==b&&q(a,
b);return a}function T(){return c("dot-atom",e(k(g(m)),ja,k(g(m)))())}function ka(){return c("qtext",h(function(){return r(function(a){var b=a.charCodeAt(0),b=33===b||35<=b&&91>=b||93<=b&&126>=b;d.rfc6532&&(b=b||128<=a.charCodeAt(0));return b})},la)())}function ma(){return c("qcontent",h(ka,H)())}function U(){return c("quoted-string",e(k(g(m)),k(R),l(e(g(C(t)),ma)),g(k(t)),k(R),k(g(m)))())}function z(){return c("word",h(J,U)())}function v(){return c("address",h(u,V)())}function u(){return c("mailbox",
h(na,K)())}function na(){return c("name-addr",e(g(W),X)())}function X(){return c("angle-addr",h(e(k(g(m)),f("<"),K,f(">"),k(g(m))),oa)())}function V(){return c("group",e(W,f(":"),g(pa),f(";"),k(g(m)))())}function W(){var a=c("phrase",h(qa,l(z,1))());null!==a&&(a.semantic=a.semantic.replace(/([ \t]|\r\n)+/g," ").replace(/^\s*/,"").replace(/\s*$/,""));return c("display-name",a)}function L(){return c("mailbox-list",h(e(u,l(e(f(","),u))),ra)())}function E(){return c("address-list",h(e(v,l(e(f(","),v))),
sa)())}function pa(){return c("group-list",h(L,k(m),ta)())}function ua(){return c("local-part",h(va,T,U)())}function wa(){return c("dtext",h(function(){return r(function(a){var b=a.charCodeAt(0),b=33<=b&&90>=b||94<=b&&126>=b;d.rfc6532&&(b=b||128<=a.charCodeAt(0));return b})},xa)())}function ya(){return c("domain-literal",e(k(g(m)),f("["),l(e(g(t),wa)),g(t),f("]"),k(g(m)))())}function M(){var a=h(za,T,ya)();d.rejectTLD&&0>a.semantic.indexOf(".")?a=null:a&&(a.semantic=a.semantic.replace(/\s+/g,""));
return c("domain",a)}function K(){return c("addr-spec",e(ua,f("@"),M)())}function F(){return d.strict?null:c("obs-NO-WS-CTL",r(function(a){a=a.charCodeAt(0);return 1<=a&&8>=a||11===a||12===a||14<=a&&31>=a||127===a}))}function ha(){return d.strict?null:c("obs-ctext",F())}function la(){return d.strict?null:c("obs-qtext",F())}function ea(){return d.strict?null:c("obs-qp",e(f("\\"),h(f("\x00"),F,Q,O))())}function qa(){return d.strict?null:c("obs-phrase",e(z,l(h(z,f("."),C(m))))())}function fa(){return d.strict?
null:c("obs-FWS",l(e(k(g(P)),D),1)())}function oa(){return d.strict?null:c("obs-angle-addr",e(k(g(m)),f("<"),Aa,K,f(">"),k(g(m)))())}function Aa(){return d.strict?null:c("obs-route",e(Ba,f(":"))())}function Ba(){return d.strict?null:c("obs-domain-list",e(l(h(k(m),f(","))),f("@"),M,l(e(f(","),k(g(m)),g(e(f("@"),M)))))())}function ra(){return d.strict?null:c("obs-mbox-list",e(l(e(k(g(m)),f(","))),u,l(e(f(","),g(e(u,k(m))))))())}function sa(){return d.strict?null:c("obs-addr-list",e(l(e(k(g(m)),f(","))),
v,l(e(f(","),g(e(v,k(m))))))())}function ta(){return d.strict?null:c("obs-group-list",e(l(e(k(g(m)),f(",")),1),k(g(m)))())}function va(){return d.strict?null:c("obs-local-part",e(z,l(e(f("."),z)))())}function za(){return d.strict?null:c("obs-domain",e(J,l(e(f("."),J)))())}function xa(){return d.strict?null:c("obs-dtext",h(F,H)())}function A(a,b){var c;if(null===b||void 0===b)return null;for(c=[b];0<c.length;){var d=c.pop();if(d.name===a)return d;for(b=d.children.length-1;0<=b;--b)c.push(d.children[b])}return null}
function Y(a,b){if(null===b||void 0===b)return null;var c=[b];var d=[];var e={};for(b=0;b<a.length;b+=1)e[a[b]]=!0;for(;0<c.length;)if(a=c.pop(),a.name in e)d.push(a);else for(b=a.children.length-1;0<=b;--b)c.push(a.children[b]);return d}function Z(a){var b;if(null===a)return null;var c=[];var e=Y(["group","mailbox"],a);for(b=0;b<e.length;b+=1){var f=e[b];"group"===f.name?c.push(Ca(f)):"mailbox"===f.name&&c.push(aa(f))}a={ast:a,addresses:c};if(d.simple&&a&&a.addresses)for(c=0;c<a.addresses.length;c+=
1)delete a.addresses[c].node;return d.oneResult?(a=a?!d.partial&&1<a.addresses.length?null:a.addresses&&a.addresses[0]:null,a):d.simple?a&&a.addresses:a}function Ca(a){var b,c=A("display-name",a),d=[],e=Y(["mailbox"],a);for(b=0;b<e.length;b+=1)d.push(aa(e[b]));return{node:a,parts:{name:c},type:a.name,name:w(c),addresses:d}}function aa(a){var b=A("display-name",a),c=A("addr-spec",a);var d;if(null===a||void 0===a)var e=null;else{var f=[a];for(d=[];0<f.length;){var g=f.pop();"cfws"===g.name&&d.push(g);
for(e=g.children.length-1;0<=e;--e)f.push(g.children[e])}e=d}f=A("local-part",c);g=A("domain",c);return{node:a,parts:{name:b,address:c,local:f,domain:g,comments:e},type:a.name,name:w(b),address:w(c),local:w(f),domain:w(g),groupName:w(a.groupName)}}function w(a){return null!==a&&void 0!==a?a.semantic:null}d=x(d,{});if(null===d)return null;var y=d.input;var ba={address:v,"address-list":E,"angle-addr":X,from:function(){return c("from",h(L,E)())},group:V,mailbox:u,"mailbox-list":L,"reply-to":function(){return c("reply-to",
E())},sender:function(){return c("sender",h(u,v)())}}[d.startAt]||E;if(!d.strict){var p=0;var B=y.length;d.strict=!0;var N=ba(y);if(d.partial||!(p<B))return Z(N);d.strict=!1}p=0;B=y.length;N=ba(y);return!d.partial&&p<B?null:Z(N)}function x(d,n){function c(c){return null===c||void 0===c}var q;if("[object String]"===Object.prototype.toString.call(d))d={input:d};else if(d!==Object(d))return null;if("[object String]"!==Object.prototype.toString.call(d.input)||!n)return null;var r={oneResult:!1,partial:!1,
rejectTLD:!1,rfc6532:!1,simple:!1,startAt:"address-list",strict:!1};for(q in r)c(d[q])&&(d[q]=c(n[q])?r[q]:n[q]);return d}n.parseOneAddress=function(d){return n(x(d,{oneResult:!0,rfc6532:!0,simple:!0,startAt:"address-list"}))};n.parseAddressList=function(d){return n(x(d,{rfc6532:!0,simple:!0,startAt:"address-list"}))};n.parseFrom=function(d){return n(x(d,{rfc6532:!0,simple:!0,startAt:"from"}))};n.parseSender=function(d){return n(x(d,{oneResult:!0,rfc6532:!0,simple:!0,startAt:"sender"}))};n.parseReplyTo=
function(d){return n(x(d,{rfc6532:!0,simple:!0,startAt:"reply-to"}))};"undefined"!==typeof module&&"undefined"!==typeof module.exports?module.exports=n:G.emailAddresses=n})(this);
